<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Voxtral Transcription - AI-Powered Audio Transcription</title>
    <meta name="theme-color" content="#f8efe0">
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Space+Grotesk:wght@400;500;600;700&family=Inter:wght@400;500;600&display=swap" rel="stylesheet">
    <link rel="icon" type="image/svg+xml" href="{{ url_for('static', filename='img/voxtral-icon.svg') }}">
    <link rel="stylesheet" href="{{ url_for('static', filename='css/style.css') }}">
</head>
<body>
    <div class="app-shell">
        <!-- System Banners -->
        <!-- Memory Warning Banner -->
        <div class="system-banner banner-warning" id="memoryBanner" style="display: none;">
            <div class="banner-content">
                <div class="banner-icon">‚ö†Ô∏è</div>
                <div class="banner-text">
                    <strong id="memoryBannerTitle">High Memory Usage</strong>
                    <span id="memoryBannerMessage">Your system memory is running high.</span>
                </div>
                <button class="banner-close" id="closeMemoryBanner" aria-label="Dismiss warning">‚úï</button>
            </div>
        </div>

        <!-- Update Available Banner -->
        <div class="system-banner banner-update" id="updateBanner" style="display: none;">
            <div class="banner-content">
                <div class="banner-icon">üéâ</div>
                <div class="banner-text">
                    <strong>Update Available</strong>
                    <span id="updateBannerMessage">A new version is available.</span>
                </div>
                <div class="banner-actions">
                    <button class="banner-btn" id="installUpdateBtn">Update Now</button>
                    <a class="banner-btn" id="viewReleaseBtn" href="#" target="_blank" rel="noopener noreferrer">View Release</a>
                    <button class="banner-close" id="closeUpdateBanner" aria-label="Dismiss">‚úï</button>
                </div>
            </div>
        </div>

        <header class="hero">
            <div class="hero-icon">
                <img src="{{ url_for('static', filename='img/voxtral-icon.svg') }}" alt="Voxtral icon">
            </div>
            <div class="hero-copy">
                <p class="hero-eyebrow">Simply Bastiaan ¬∑ Local-first transcription</p>
                <h1>Need privacy proof? Every file stays on this device.</h1>
                <p class="hero-body">
                    Voxtral keeps recordings, processing, and transcripts on your hardware. Nothing leaves your
                    machine‚Äîjust drop a file and let the amber-guided UI walk you through the workflow.
                </p>
                <div class="hero-facts">
                    <span class="fact-pill accent">Mistral Mini 3B</span>
                    <span class="fact-pill">Audio &amp; video ready</span>
                    <span class="fact-pill" id="deviceBadge">Running on <strong id="deviceName">{{ device_info.device_name or 'CPU' }}</strong></span>
                </div>
            </div>
        </header>

        <main class="workspace">
            <!-- File Upload Section -->
            <section class="card upload-section">
                <div class="card-header">
                    <div>
                        <p class="eyebrow">Step 1</p>
                        <h2>Bring your media</h2>
                    </div>
                </div>
                <div class="upload-area" id="uploadArea">
                    <input type="file" id="fileInput" accept=".wav,.mp3,.flac,.m4a,.mp4,.avi,.mov" hidden>
                    <div class="upload-icon">üìÅ</div>
                    <h3>Drag &amp; Drop Audio/Video File</h3>
                    <p>or click to browse</p>
                    <p class="file-types">Supported: MP3, M4A, MP4, WAV, FLAC, AVI, MOV</p>
                    <p class="file-size-limit">Max file size: 500MB</p>
                </div>

                <!-- Selected File Info -->
                <div class="file-info" id="fileInfo" style="display: none;">
                    <div class="file-details">
                        <span class="file-icon">üìÑ</span>
                        <div class="file-text">
                            <div class="file-name" id="fileName">filename.mp3</div>
                            <div class="file-meta">
                                <span id="fileSize">0 MB</span>
                                <span id="fileType"></span>
                            </div>
                        </div>
                        <button class="btn-remove" id="removeFile" title="Remove file">‚úï</button>
                    </div>
                </div>
            </section>

            <!-- Language & Controls Section -->
            <section class="card controls-section">
                <div class="card-header">
                    <div>
                        <p class="eyebrow">Step 2</p>
                        <h2>Choose settings</h2>
                    </div>
                </div>
                <div class="controls-grid">
                    <div class="control-group">
                        <label for="languageSelect">Transcription Language</label>
                        <div class="select-wrapper">
                            <select id="languageSelect">
                                <option value="en">English</option>
                            </select>
                        </div>
                    </div>

                    <button class="btn-primary" id="transcribeBtn" disabled>
                        Start Transcription
                    </button>
                </div>
            </section>

            <!-- Progress Section -->
            <section class="card progress-section" id="progressSection" style="display: none;">
                <div class="card-header">
                    <div>
                        <p class="eyebrow">Step 3</p>
                        <h2>Progress</h2>
                    </div>
                    <span class="status-pill">Live</span>
                </div>
                <div class="progress-card">
                    <div class="progress-header">
                        <span class="progress-status" id="progressStatus">Ready</span>
                        <span class="progress-percentage" id="progressPercentage">0%</span>
                    </div>
                    <div class="progress-bar">
                        <div class="progress-fill" id="progressFill" style="width: 0%"></div>
                    </div>
                    <div class="progress-meta">
                        <div class="progress-details" id="progressDetails">Waiting to start...</div>
                        <div class="progress-eta" id="progressEta"></div>
                    </div>
                </div>
            </section>

            <!-- Transcript Section -->
            <section class="card transcript-section" id="transcriptSection" style="display: none;">
                <div class="transcript-header">
                    <div>
                        <p class="eyebrow">Results</p>
                        <h3>Transcript</h3>
                    </div>
                    <div class="transcript-actions">
                        <button class="btn-secondary" id="copyBtn" title="Copy to clipboard">
                            <span class="btn-icon">üìã</span> Copy
                        </button>
                        <button class="btn-secondary" id="downloadBtn" title="Download as text file">
                            <span class="btn-icon">üíæ</span> Download
                        </button>
                        <button class="btn-secondary" id="clearBtn" title="Clear transcript">
                            <span class="btn-icon">üóëÔ∏è</span> Clear
                        </button>
                    </div>
                </div>
                <div class="transcript-stats" id="transcriptStats">
                    <span><strong>Words:</strong> <span id="wordCount">0</span></span>
                    <span><strong>Characters:</strong> <span id="charCount">0</span></span>
                    <span><strong>Duration:</strong> <span id="audioDuration">0:00</span></span>
                </div>
                <div class="transcript-content" id="transcriptContent">
                    <div class="transcript-placeholder">
                        Your transcription will appear here...
                    </div>
                </div>
            </section>

            <div class="workspace-actions">
                <button class="btn-ghost" id="toggleHistory">
                    <span class="btn-icon">üìö</span> View History
                </button>
                <button class="btn-ghost" id="checkUpdateBtn">
                    <span class="btn-icon">üîÑ</span> Check for Updates
                </button>
                <span class="workspace-note">Review previous runs without leaving your device.</span>
            </div>
        </main>

        <!-- Footer -->
        <footer class="footer">
            <p>
                Crafted with ‚ù§Ô∏è by Simply Bastiaan | Powered by <strong>Mistral AI Voxtral-Mini-3B</strong> |
                <a href="https://www.simplybastiaan.com/" target="_blank" rel="noreferrer">simplybastiaan.com</a>
            </p>
        </footer>
    </div>

    <!-- History Overlay -->
    <div class="history-overlay" id="historyOverlay" aria-hidden="true">
        <div class="history-backdrop" id="historyBackdrop"></div>
        <section class="history-panel" id="historySection">
            <div class="history-header">
                <div>
                    <p class="eyebrow">Session memory</p>
                    <h3>üìö History</h3>
                </div>
                <button class="drawer-close" id="closeHistory" aria-label="Close history">‚úï</button>
            </div>
            <div class="history-tabs">
                <button class="tab-btn active" id="tabTranscriptions">Transcriptions</button>
                <button class="tab-btn" id="tabUploads">Uploads</button>
            </div>

            <!-- Transcriptions Tab -->
            <div class="history-content" id="transcriptionsTab">
                <div class="history-actions">
                    <button class="btn-secondary btn-sm" id="refreshTranscriptions">
                        <span class="btn-icon">üîÑ</span> Refresh
                    </button>
                    <button class="btn-secondary btn-sm btn-danger" id="deleteAllTranscriptions">
                        <span class="btn-icon">üóëÔ∏è</span> Delete All
                    </button>
                </div>
                <div class="history-list" id="transcriptionsList">
                    <div class="history-placeholder">No transcriptions yet</div>
                </div>
            </div>

            <!-- Uploads Tab -->
            <div class="history-content" id="uploadsTab" style="display: none;">
                <div class="history-actions">
                    <button class="btn-secondary btn-sm" id="refreshUploads">
                        <span class="btn-icon">üîÑ</span> Refresh
                    </button>
                    <button class="btn-secondary btn-sm btn-danger" id="deleteAllUploads">
                        <span class="btn-icon">üóëÔ∏è</span> Delete All
                    </button>
                </div>
                <div class="history-list" id="uploadsList">
                    <div class="history-placeholder">No uploads yet</div>
                </div>
            </div>
        </section>
    </div>

    <!-- Model Selection Modal -->
    <div class="model-modal" id="modelModal" style="display: none;">
        <div class="model-modal-backdrop"></div>
        <div class="model-modal-content">
            <div class="model-modal-header">
                <h2>Choose Your Model</h2>
                <p class="model-modal-subtitle">Select which Voxtral model to use for transcription</p>
            </div>

            <div class="model-selection-grid" id="modelGrid">
                <!-- Model cards will be inserted here by JavaScript -->
            </div>

            <div class="model-modal-footer">
                <button class="btn-primary btn-large" id="initializeModelBtn" disabled>
                    Initialize Model
                </button>
            </div>

            <!-- Loading state -->
            <div class="model-loading-overlay" id="modelLoadingOverlay" style="display: none;">
                <div class="model-loading-content">
                    <div class="spinner"></div>
                    <h3 id="modelLoadingTitle">Loading Model...</h3>
                    <p id="modelLoadingMessage">This may take a few minutes...</p>
                    <div class="model-loading-tips">
                        <p><strong>Please wait:</strong></p>
                        <ul>
                            <li>Do not close this window</li>
                            <li>Model files will be downloaded if needed</li>
                            <li>Progress will update automatically</li>
                        </ul>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Toast Notification -->
    <div class="toast" id="toast"></div>

    <!-- Scripts -->
    <script src="https://cdn.socket.io/4.5.4/socket.io.min.js"></script>
    <script src="{{ url_for('static', filename='js/app.js') }}"></script>
</body>
</html>
